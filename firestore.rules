rules_version = '2';

function isSignedIn() {
  return request.auth != null;
}

service cloud.firestore {
  match /databases/{database}/documents {

    // Catálogo: lectura pública, escritura autenticados
    match /productos/{productId} {
      allow read: if true;
      allow write: if isSignedIn();
    }

    match /categorias/{categoriaId} {
      allow read: if true;
      allow write: if isSignedIn();
    }

    // Usuarios: lectura y escritura para cualquier autenticado
    // (controlas quién puede hacer qué desde el frontend por rol)
    match /usuarios/{userId} {
      allow read: if isSignedIn();
      allow create, update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    // Órdenes: cualquier autenticado puede leer y escribir
    // (el superadmin las ve todas; el cliente solo accede vía frontend filtrado por userId)
    match /orders/{orderId} {
      allow read, write: if isSignedIn();
    }

    // Bloquear colecciones no declaradas
    match /{document=**} {
      allow read, write: if false;
    }
  }
}